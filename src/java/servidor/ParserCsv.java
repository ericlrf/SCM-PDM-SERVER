package servidor;

import com.opencsv.CSVReader;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;
//import java.util.Date;
import java.util.List;
import org.json.CDL;
import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

/**
 * Classe Java responsavel por tratar os dados nos arquivos ".csv" baixados no
 * site do BCB
 */
public class ParserCsv {

    String dadosCotacao = "";
    String dadosMoedas = "";

    static JSONArray arrayJsonCotacao;
    static JSONArray arrayJsonMoedas;
            
    private String filePathCotacao;
    private String filePathMoedas;
    private FileReader fileReaderCotacao;
    private FileReader fileReaderMoedas;
    private final CSVReader csvReaderCotacao;
    private final CSVReader csvReaderMoedas;
    private final List<String[]> allRowsCotacao;
    private final List<String[]> allRowsMoedas;

    /**
     * Construtor da classe, responsavel por inicializar o carregamento dos
     * arquivos ".csv"
     *
     * @throws java.io.FileNotFoundException
     */
    public ParserCsv() throws FileNotFoundException, IOException {
        atualizarCsv();
        abrirCsv();
        csvReaderCotacao = new CSVReader(fileReaderCotacao, ';', '"', 0);
        csvReaderMoedas = new CSVReader(fileReaderMoedas, ';', '"', 0);
        allRowsCotacao = csvReaderCotacao.readAll();
        allRowsMoedas = csvReaderMoedas.readAll();
        csvToJson();
        csvToString(); // apenas para testar localmente
    }

    /**
     * Metodo utiliza a data e hora do Sistema para carregar o arquivo com os
     * dados mais atualizado pelo PTAX
     */
    private void atualizarCsv() {
//        Date currentTime = new Date(System.currentTimeMillis());
//        String dataHoje = currentTime.getDate();
//        filePathCotacao = dataHoje.concat(".csv");
        filePathCotacao = "arquivosBCB/20151009.csv";
        filePathMoedas = "arquivosBCB/M20151013.csv";
    }

    private void abrirCsv() throws FileNotFoundException {
        this.fileReaderCotacao = new FileReader(filePathCotacao);
        this.fileReaderMoedas = new FileReader(filePathMoedas);
    }

    private void csvToJson() throws JSONException {
        String temp = "Data,Cod Moeda,Tipo,Moeda,Taxa Compra,Taxa Venda,Paridade Compra,Paridade Venda\n" +
"09/10/2015,005,A,AFN,0,05753000,0,05821000,64,23000000,64,98000000\n" +
"09/10/2015,009,A,ETB,0,17570000,0,17990000,20,78000000,21,28000000\n" +
"09/10/2015,015,A,THB,0,10520000,0,10530000,35,52000000,35,54000000\n" +
"09/10/2015,020,A,PAB,3,73800000,3,73860000,1,00000000,1,00000000\n" +
"09/10/2015,026,A,VEF,0,59330000,0,59490000,6,28420000,6,30000000\n" +
"09/10/2015,030,A,BOB,0,53710000,0,54500000,6,86000000,6,96000000\n" +
"09/10/2015,035,A,GHS,0,99150000,0,99700000,3,75000000,3,77000000\n" +
"09/10/2015,040,A,CRC,0,00693500,0,00706700,528,99000000,538,99000000\n" +
"09/10/2015,045,A,SVC,0,42800000,0,42850000,8,72400000,8,73400000\n" +
"09/10/2015,051,A,NIO,0,13500000,0,13880000,26,93000000,27,68000000\n" +
"09/10/2015,055,A,DKK,0,56930000,0,56940000,6,56540000,6,56630000\n" +
"09/10/2015,060,A,ISK,0,02989000,0,02996000,124,78000000,125,06000000\n" +
"09/10/2015,065,A,NOK,0,46250000,0,46280000,8,07780000,8,08200000\n" +
"09/10/2015,070,A,SEK,0,45670000,0,45690000,8,18290000,8,18520000\n" +
"09/10/2015,075,A,CZK,0,15660000,0,15690000,23,82200000,23,87200000\n" +
"09/10/2015,090,A,GMD,0,09516000,0,09691000,38,58000000,39,28000000\n" +
"09/10/2015,095,A,DZD,0,03525000,0,03554000,105,19100000,106,03200000\n" +
"09/10/2015,100,A,KWD,12,37340000,12,38360000,0,30190000,0,30210000\n" +
"09/10/2015,105,A,BHD,9,90720000,9,91410000,0,37710000,0,37730000\n" +
"09/10/2015,115,A,IQD,0,00331400,0,00332000,1126,00000000,1128,00000000\n" +
"09/10/2015,125,A,JOD,5,27820000,5,28420000,0,70750000,0,70820000\n" +
"09/10/2015,130,A,LYD,2,71160000,2,72200000,1,37350000,1,37850000\n" +
"09/10/2015,132,A,MKD,0,06895000,0,06923000,54,00000000,54,21000000\n" +
"09/10/2015,133,A,RSD,0,03542000,0,03546000,105,43000000,105,52000000\n" +
"09/10/2015,134,A,SDG,0,60980000,0,61590000,6,07000000,6,13000000\n" +
"09/10/2015,135,A,TND,1,91450000,1,91770000,1,94950000,1,95250000\n" +
"09/10/2015,136,A,SSP,1,23570000,1,24620000,3,00000000,3,02500000\n" +
"09/10/2015,138,B,SDR,5,27620000,5,27700000,1,41150000,1,41150000\n" +
"09/10/2015,139,A,MAD,0,38710000,0,38890000,9,61300000,9,65600000\n" +
"09/10/2015,145,A,AED,1,01760000,1,01800000,3,67240000,3,67340000\n" +
"09/10/2015,148,A,STD,0,00017310,0,00017360,21530,00000000,21600,00000000\n" +
"09/10/2015,150,B,AUD,2,73850000,2,73960000,0,73260000,0,73280000\n" +
"09/10/2015,155,A,BSD,3,73800000,3,73860000,1,00000000,1,00000000\n" +
"09/10/2015,160,A,BMD,3,73800000,3,73860000,1,00000000,1,00000000\n" +
"09/10/2015,165,A,CAD,2,88690000,2,88830000,1,29440000,1,29480000\n" +
"09/10/2015,170,A,GYD,0,01793000,0,01815000,205,98000000,208,44000000\n" +
"09/10/2015,173,A,NAD,0,28060000,0,28070000,13,31800000,13,32050000\n" +
"09/10/2015,175,A,BBD,1,85970000,1,86930000,2,00000000,2,01000000\n" +
"09/10/2015,180,A,BZD,1,85970000,1,88820000,1,98000000,2,01000000\n" +
"09/10/2015,185,A,BND,2,65970000,2,66230000,1,40430000,1,40540000\n" +
"09/10/2015,190,A,KYD,4,50360000,4,55930000,0,82000000,0,83000000\n" +
"09/10/2015,195,A,SGD,2,67920000,2,68100000,1,39450000,1,39520000\n" +
"09/10/2015,197,B,CLF,140,04790000,140,07040000,37,46600000,37,46600000\n" +
"09/10/2015,200,B,FJD,1,73560000,1,77320000,0,46430000,0,47430000\n" +
"09/10/2015,205,A,HKD,0,48230000,0,48240000,7,74980000,7,75030000\n" +
"09/10/2015,210,A,TTD,0,58620000,0,59090000,6,32720000,6,37720000\n" +
"09/10/2015,215,A,XCD,1,37430000,1,38980000,2,69000000,2,72000000\n" +
"09/10/2015,220,A,USD,3,73800000,3,73860000,1,00000000,1,00000000\n" +
"09/10/2015,230,A,JMD,0,03147000,0,03161000,118,27000000,118,77000000\n" +
"09/10/2015,235,A,LRD,0,04297000,0,04532000,82,50000000,87,00000000\n" +
"09/10/2015,245,B,NZD,2,50370000,2,50600000,0,66980000,0,67030000\n" +
"09/10/2015,250,B,SBD,0,45450000,0,46210000,0,12160000,0,12360000\n" +
"09/10/2015,255,A,SRD,1,13270000,1,15030000,3,25000000,3,30000000\n" +
"09/10/2015,260,A,VND,0,00016780,0,00016860,22172,00000000,22282,00000000\n" +
"09/10/2015,275,A,AMD,0,00784600,0,00789700,473,45000000,476,45000000\n" +
"09/10/2015,295,A,CVE,0,03812000,0,03860000,96,85000000,98,05000000\n" +
"09/10/2015,325,A,ANG,2,08830000,2,11220000,1,77000000,1,79000000\n" +
"09/10/2015,328,A,AWG,2,06520000,2,08860000,1,79000000,1,81000000\n" +
"09/10/2015,345,A,HUF,0,01363000,0,01366000,273,62000000,274,29000000\n" +
"09/10/2015,363,A,CDF,0,00405400,0,00409900,912,00000000,922,00000000\n" +
"09/10/2015,365,A,BIF,0,00242400,0,00244000,1532,00000000,1542,00000000\n" +
"09/10/2015,368,A,KMF,0,00852700,0,00854800,437,35000000,438,35000000\n" +
"09/10/2015,370,A,XAF,0,00643200,0,00647800,577,17000000,581,17000000\n" +
"09/10/2015,372,A,XOF,0,00641900,0,00647600,577,33000000,582,33000000\n" +
"09/10/2015,380,A,XPF,0,03551000,0,03581000,104,39000000,105,27000000\n" +
"09/10/2015,390,A,DJF,0,02099000,0,02119000,176,40000000,178,10000000\n" +
"09/10/2015,398,A,GNF,0,00049240,0,00050580,7391,00000000,7591,00000000\n" +
"09/10/2015,406,A,MGA,0,00119900,0,00120700,3098,00000000,3118,00000000\n" +
"09/10/2015,420,A,RWF,0,00505700,0,00510700,732,12000000,739,12000000\n" +
"09/10/2015,425,A,CHF,3,88530000,3,88990000,0,96110000,0,96210000\n" +
"09/10/2015,440,A,HTG,0,06794000,0,07027000,53,20460000,55,01650000\n" +
"09/10/2015,450,A,PYG,0,00066380,0,00066440,5626,65000000,5630,90000000\n" +
"09/10/2015,460,A,UAH,0,16990000,0,17410000,21,47100000,22,00300000\n" +
"09/10/2015,470,A,JPY,0,03107000,0,03109000,120,27000000,120,32000000\n" +
"09/10/2015,482,A,GEL,1,54460000,1,58420000,2,36000000,2,42000000\n" +
"09/10/2015,490,A,ALL,0,03036000,0,03057000,122,29000000,123,14000000\n" +
"09/10/2015,495,A,HNL,0,17130000,0,17210000,21,72000000,21,82000000\n" +
"09/10/2015,500,A,SLL,0,00088580,0,00090740,4120,00000000,4220,00000000\n" +
"09/10/2015,503,A,MDL,0,18810000,0,19070000,19,60000000,19,87000000\n" +
"09/10/2015,506,A,RON,0,96160000,0,96310000,3,88170000,3,88710000\n" +
"09/10/2015,510,A,BGN,2,17150000,2,17260000,1,72080000,1,72140000\n" +
"09/10/2015,530,B,GIP,5,74160000,5,74470000,1,53600000,1,53660000\n" +
"09/10/2015,535,A,EGP,0,47740000,0,47750000,7,83000000,7,83010000\n" +
"09/10/2015,540,B,GBP,5,72360000,5,72640000,1,53120000,1,53170000\n" +
"09/10/2015,545,B,FKP,5,74160000,5,74620000,1,53600000,1,53700000\n" +
"09/10/2015,560,A,LBP,0,00247700,0,00248600,1504,00000000,1509,00000000\n" +
"09/10/2015,570,B,SHP,5,80440000,5,81280000,1,55280000,1,55480000\n" +
"09/10/2015,575,A,SYP,0,01689000,0,01693000,220,77000000,221,37000000\n" +
"09/10/2015,585,A,SZL,0,28010000,0,28120000,13,29400000,13,34400000\n" +
"09/10/2015,603,A,LSL,0,28010000,0,28120000,13,29500000,13,34500000\n" +
"09/10/2015,608,A,TMT,1,02410000,1,11600000,3,35000000,3,65000000\n" +
"09/10/2015,622,A,MZN,0,08693000,0,08901000,42,00000000,43,00000000\n" +
"09/10/2015,625,A,ERN,0,24300000,0,25130000,14,88000000,15,38000000\n" +
"09/10/2015,630,A,NGN,0,01874000,0,01879000,199,00000000,199,50000000\n" +
"09/10/2015,635,A,AOA,0,02731000,0,02752000,135,84000000,136,88000000\n" +
"09/10/2015,640,A,TWD,0,11590000,0,11590000,32,24400000,32,26400000\n" +
"09/10/2015,642,A,TRY,1,28190000,1,28300000,2,91400000,2,91600000\n" +
"09/10/2015,660,A,PEN,1,16300000,1,16470000,3,21000000,3,21400000\n" +
"09/10/2015,665,A,BTN,0,05773000,0,05776000,64,72400000,64,74600000\n" +
"09/10/2015,670,A,MRO,0,01271000,0,01307000,286,00000000,294,00000000\n" +
"09/10/2015,680,B,TOP,1,64550000,1,77580000,0,44020000,0,47500000\n" +
"09/10/2015,685,A,MOP,0,46770000,0,46860000,7,97800000,7,99300000\n" +
"09/10/2015,706,A,ARS,0,39940000,0,39960000,9,35580000,9,35980000\n" +
"09/10/2015,715,A,CLP,0,00551700,0,00552000,677,30000000,677,60000000\n" +
"09/10/2015,720,A,COP,0,00130600,0,00130800,2857,30000000,2862,30000000\n" +
"09/10/2015,725,A,CUP,3,73800000,3,73860000,1,00000000,1,00000000\n" +
"09/10/2015,730,A,DOP,0,08250000,0,08269000,45,21000000,45,31000000\n" +
"09/10/2015,735,A,PHP,0,08174000,0,08183000,45,69000000,45,73000000\n" +
"09/10/2015,741,A,MXN,0,22770000,0,22780000,16,41000000,16,41900000\n" +
"09/10/2015,745,A,UYU,0,12820000,0,12850000,29,10000000,29,15000000\n" +
"09/10/2015,755,B,BWP,0,36150000,0,36380000,0,09670000,0,09730000\n" +
"09/10/2015,760,A,MWK,0,00667500,0,00673600,555,00000000,560,00000000\n" +
"09/10/2015,766,A,ZMW,0,31680000,0,31740000,11,78000000,11,80000000\n" +
"09/10/2015,770,A,GTQ,0,48670000,0,48690000,7,67800000,7,68100000\n" +
"09/10/2015,775,A,MMK,0,00289500,0,00290300,1288,00000000,1291,00000000\n" +
"09/10/2015,778,B,PGK,1,27840000,1,32530000,0,34200000,0,35450000\n" +
"09/10/2015,779,A,HRK,0,55690000,0,55720000,6,70920000,6,71180000\n" +
"09/10/2015,780,A,LAK,0,00045750,0,00046040,8121,00000000,8171,00000000\n" +
"09/10/2015,785,A,ZAR,0,28060000,0,28080000,13,31450000,13,31950000\n" +
"09/10/2015,795,A,CNY,0,58910000,0,58920000,6,34500000,6,34550000\n" +
"09/10/2015,796,A,CNH,0,58940000,0,58970000,6,33990000,6,34160000\n" +
"09/10/2015,800,A,QAR,1,02640000,1,02670000,3,64150000,3,64200000\n" +
"09/10/2015,805,A,OMR,9,70660000,9,71320000,0,38490000,0,38510000\n" +
"09/10/2015,810,A,YER,0,01739000,0,01740000,214,85000000,214,93000000\n" +
"09/10/2015,815,A,IRR,0,00012480,0,00012480,29957,00000000,29957,00000000\n" +
"09/10/2015,820,A,SAR,0,99670000,0,99700000,3,74990000,3,75040000\n" +
"09/10/2015,825,A,KHR,0,00091390,0,00092540,4040,00000000,4090,00000000\n" +
"09/10/2015,828,A,MYR,0,90180000,0,90410000,4,13500000,4,14500000\n" +
"09/10/2015,829,A,BYR,0,00021750,0,00021790,17160,00000000,17190,00000000\n" +
"09/10/2015,830,A,RUB,0,06073000,0,06086000,61,42470000,61,55470000\n" +
"09/10/2015,835,A,TJS,0,57820000,0,57920000,6,45500000,6,46500000\n" +
"09/10/2015,840,A,MUR,0,10510000,0,10570000,35,36000000,35,56000000\n" +
"09/10/2015,845,A,NPR,0,03553000,0,03591000,104,10000000,105,20000000\n" +
"09/10/2015,850,A,SCR,0,28070000,0,28620000,13,06500000,13,31500000\n" +
"09/10/2015,855,A,LKR,0,02648000,0,02654000,140,85000000,141,15000000\n" +
"09/10/2015,860,A,INR,0,05771000,0,05773000,64,75650000,64,77650000\n" +
"09/10/2015,865,A,IDR,0,00027830,0,00027880,13410,00000000,13430,00000000\n" +
"09/10/2015,870,A,MVR,0,23920000,0,24360000,15,35000000,15,63000000\n" +
"09/10/2015,875,A,PKR,0,03577000,0,03584000,104,30000000,104,50000000\n" +
"09/10/2015,880,A,ILS,0,97580000,0,97730000,3,82560000,3,83060000\n" +
"09/10/2015,892,A,KGS,0,05383000,0,05407000,69,14000000,69,44000000\n" +
"09/10/2015,893,A,UZS,0,00141800,0,00142300,2627,00000000,2637,00000000\n" +
"09/10/2015,905,A,BDT,0,04798000,0,04815000,77,65000000,77,90000000\n" +
"09/10/2015,912,B,WST,1,36890000,1,45810000,0,36620000,0,39000000\n" +
"09/10/2015,913,A,KZT,0,01361000,0,01361000,274,60000000,274,70000000\n" +
"09/10/2015,915,A,MNT,0,00187000,0,00187900,1990,00000000,1999,00000000\n" +
"09/10/2015,920,A,VUV,0,03377000,0,03439000,108,70000000,110,70000000\n" +
"09/10/2015,930,A,KRW,0,00325800,0,00326400,1145,28000000,1147,28000000\n" +
"09/10/2015,946,A,TZS,0,00171600,0,00172400,2168,00000000,2178,00000000\n" +
"09/10/2015,950,A,KES,0,03626000,0,03633000,102,90000000,103,10000000\n" +
"09/10/2015,955,A,UGX,0,00101400,0,00101700,3677,00000000,3687,00000000\n" +
"09/10/2015,960,A,SOS,0,00579500,0,00586000,638,00000000,645,00000000\n" +
"09/10/2015,975,A,PLN,1,00490000,1,00520000,3,71910000,3,71960000\n" +
"09/10/2015,978,B,EUR,4,24670000,4,24850000,1,13610000,1,13640000\n" +
"09/10/2015,998,A,XAU,139,21790000,139,24020000,0,02685000,0,02685000";
                
            arrayJsonCotacao = CDL.toJSONArray(temp);
    }

    /**
     * metodo toString facultativo, usado apenas para testar localmente
     */
    private void csvToString() {
        for (String[] rowCotacao : allRowsCotacao) {
            for (String columnCotacao : rowCotacao) {
                dadosCotacao = dadosCotacao.concat(columnCotacao);
                dadosCotacao = dadosCotacao.concat(",");
            }
            dadosCotacao = dadosCotacao.substring(0, dadosCotacao.length()-1);
            dadosCotacao = dadosCotacao.concat("\n");
        }
            dadosCotacao = dadosCotacao.substring(0, dadosCotacao.length()-1);
//        for (String[] rowMoedas : allRowsMoedas) {
//            for (String columnMoedas : rowMoedas) {
//                dadosMoedas = dadosMoedas.concat(columnMoedas);
//                dadosMoedas = dadosMoedas.concat(",");
//            }
//            dadosMoedas = dadosMoedas.concat("\n");
//        }
//        System.out.print(dadosCotacao);
//        System.out.println("-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-");
//        System.out.println("-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-");
//        System.out.print(dadosMoedas);
    }

    /**
     * metodo Main executa o construtor da Classe ParserCsv
     *
     * @param args
     * @throws java.io.IOException
     */
    public static void main(String[] args) throws IOException {
        ParserCsv parserCsv = new ParserCsv();
        System.out.println(arrayJsonCotacao.toString(2));
    }
}
